[build]
  base = "Brandible"
  command = "bash ./scripts/inject-env.sh"
  publish = "."

# Configure Netlify to allow Supabase public keys in the generated config.js
# These are intentionally public values (anon keys) meant for client-side use
[build.environment]
  # Allow Supabase public keys (anon keys are safe to expose)
  SECRETS_SCAN_OMIT_KEYS = "SUPABASE_PUBLIC_KEY,SUPABASE_URL"

# Alternative: Instead of omitting keys, you can omit the specific file path
# SECRETS_SCAN_OMIT_PATHS = "Brandible/assets/js/config.js"

# Force HTTPS redirects - must be first to ensure all HTTP traffic is redirected
# Redirect non-www HTTP to www HTTPS (canonical domain)
[[redirects]]
  from = "http://brandiblemg.com/*"
  to = "https://www.brandiblemg.com/:splat"
  status = 301
  force = true

[[redirects]]
  from = "http://www.brandiblemg.com/*"
  to = "https://www.brandiblemg.com/:splat"
  status = 301
  force = true

# Redirect non-www HTTPS to www HTTPS (canonical domain)
# This must come before the catch-all to ensure proper domain canonicalization
[[redirects]]
  from = "https://brandiblemg.com/*"
  to = "https://www.brandiblemg.com/:splat"
  status = 301
  force = true

# Catch-all HTTP to HTTPS redirect (fallback)
[[redirects]]
  from = "http://*"
  to = "https://:splat"
  status = 301
  force = true

# Rewrite .html files to trailing slash versions (internal rewrite, no redirect)
[[redirects]]
  from = "/terms/"
  to = "/terms.html"
  status = 200

[[redirects]]
  from = "/privacy/"
  to = "/privacy.html"
  status = 200

# Redirect .html extension to trailing slash version
[[redirects]]
  from = "/terms.html"
  to = "/terms/"
  status = 301

[[redirects]]
  from = "/privacy.html"
  to = "/privacy/"
  status = 301

# Ensure trailing slashes for directory-based pages
[[redirects]]
  from = "/about"
  to = "/about/"
  status = 301

[[redirects]]
  from = "/contact"
  to = "/contact/"
  status = 301

[[redirects]]
  from = "/portfolio"
  to = "/portfolio/"
  status = 301

[[redirects]]
  from = "/services"
  to = "/services/"
  status = 301

[[redirects]]
  from = "/faqs"
  to = "/faqs/"
  status = 301

[[redirects]]
  from = "/careers"
  to = "/careers/"
  status = 301

# Service subdirectories - ensure trailing slashes
[[redirects]]
  from = "/services/web-design"
  to = "/services/web-design/"
  status = 301

[[redirects]]
  from = "/services/digital-marketing"
  to = "/services/digital-marketing/"
  status = 301

[[redirects]]
  from = "/services/branding"
  to = "/services/branding/"
  status = 301

[[redirects]]
  from = "/services/media-management"
  to = "/services/media-management/"
  status = 301

# Favicon rewrite - serve favicon.ico from assets directory
[[redirects]]
  from = "/favicon.ico"
  to = "/assets/favicon.ico"
  status = 200

# Explicit rewrites to ensure URLs return 200 OK
# This prevents Google from seeing redirect errors
# Homepage rewrite - ensure root returns 200 OK
[[redirects]]
  from = "/"
  to = "/index.html"
  status = 200

[[redirects]]
  from = "/about/"
  to = "/about/index.html"
  status = 200

[[redirects]]
  from = "/contact/"
  to = "/contact/index.html"
  status = 200

[[redirects]]
  from = "/portfolio/"
  to = "/portfolio/index.html"
  status = 200

[[redirects]]
  from = "/services/"
  to = "/services/index.html"
  status = 200

[[redirects]]
  from = "/faqs/"
  to = "/faqs/index.html"
  status = 200

[[redirects]]
  from = "/careers/"
  to = "/careers/index.html"
  status = 200

# Explicit rewrites for service subdirectories
[[redirects]]
  from = "/services/web-design/"
  to = "/services/web-design/index.html"
  status = 200

[[redirects]]
  from = "/services/digital-marketing/"
  to = "/services/digital-marketing/index.html"
  status = 200

[[redirects]]
  from = "/services/branding/"
  to = "/services/branding/index.html"
  status = 200

[[redirects]]
  from = "/services/media-management/"
  to = "/services/media-management/index.html"
  status = 200

